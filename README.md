# Парсер тендеров с сайта rostender.info

Эта программа предназначена для парсинга первых 100 тендеров с сайта https://rostender.info/extsearch, извлечения ключевых показателей (номер тендера, ссылка, заказчик, товары/услуги, дата окончания) и сохранения данных в базу данных SQLite и файл CSV. Программа включает простой CLI-интерфейс и REST API для доступа к данным.

## Как работает

Программа использует Selenium WebDriver для парсинга данных с сайта https://rostender.info/extsearch. Она выполняет следующие шаги:

1. **Инициализация WebDriver**: Настраивается headless-браузер (Google Chrome) для загрузки страницы.
2. **Парсинг данных**: Программа загружает страницу, выполняет поиск и извлекает данные о тендерах (до 100 записей или до 5 страниц пагинации).
3. **Сохранение данных**:
   - Данные сохраняются в SQLite базу данных (`tenders.db`) в таблицу `tenders` с полями: `id`, `number`, `link`, `customer`, `goods`, `end_date`.
   - Данные также сохраняются в CSV-файл (по умолчанию `tenders.csv`).
4. **REST API**: FastAPI предоставляет эндпоинт `/tenders` для получения сохранённых данных из базы SQLite.
5. **Логирование**: Используется модуль `logging` для записи информации о процессе парсинга и ошибок.

## Требования

- Python 3.8+
- Зависимости (указаны в `requirements.txt`):
  - `selenium`
  - `webdriver-manager`
  - `fastapi`
  - `uvicorn`
  - `argparse` (встроен в Python)
  - `csv` (встроен в Python)
  - `sqlite3` (встроен в Python)
  - `logging` (встроен в Python)

## Установка

1. **Клонируйте репозиторий или скачайте код**:
   ```bash
   git clone <URL_репозитория>
   cd <директория_проекта>
   ```

2. **Установите зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Убедитесь, что Chrome установлен**:
   Программа использует `webdriver-manager` для автоматической загрузки ChromeDriver, но сам браузер Chrome должен быть установлен на вашей системе.

## Запуск программы

### Через CLI

Программа запускается с помощью команды:

```bash
python main.py --max N --output filename.csv
```

- `--max`: Максимальное количество тендеров для парсинга (целое число, 0 < N ≤ 100). По умолчанию: 100.
- `--output`: Имя выходного CSV-файла. По умолчанию: `tenders.csv`.

Пример:

```bash
python main.py --max 50 --output my_tenders.csv
```

Эта команда спарсит 50 тендеров, сохранит их в `my_tenders.csv` и в базу данных `tenders.db`.

### Через REST API

После запуска программы FastAPI-сервер становится доступен. Для запуска сервера выполните:

```bash
python main.py
```

Сервер будет доступен по адресу `http://localhost:8000`. Эндпоинт:

- `GET /tenders`: Возвращает список всех тендеров из базы данных `tenders.db` в формате JSON.

Пример запроса:

```bash
curl http://localhost:8000/tenders
```

### Примечание

- Программа автоматически запускает FastAPI-сервер после выполнения парсинга. Если вы хотите запускать только CLI без сервера, закомментируйте строку `uvicorn.run(app, host="0.0.0.0", port=8000)` в `main.py`.

## Используемые улучшения

Для повышения надёжности и удобства использования программа включает следующие улучшения:

1. **Headless-режим Selenium**:
   - Используется опция `--headless` для работы браузера без графического интерфейса, что снижает потребление ресурсов.
   - Добавлены параметры `--no-sandbox` и `--disable-dev-shm-usage` для повышения стабильности в контейнерах или на серверах.

2. **Обработка ошибок**:
   - Логирование ошибок с помощью модуля `logging` позволяет отслеживать проблемы при парсинге или навигации по страницам.
   - Используется `try-except` для обработки исключений при парсинге отдельных тендеров или переходе между страницами.

3. **Ожидание загрузки элементов**:
   - Используется `WebDriverWait` и `expected_conditions` для ожидания загрузки страницы и элементов, что повышает надёжность парсинга.

4. **Пагинация**:
   - Программа обрабатывает до 5 страниц пагинации для получения необходимого количества тендеров.
   - Добавлены задержки (`time.sleep`) для предотвращения перегрузки сайта и корректной загрузки данных.

5. **Автоматическая установка ChromeDriver**:
   - Модуль `webdriver-manager` автоматически загружает и обновляет ChromeDriver, устраняя необходимость ручной установки.

6. **FastAPI для API**:
   - Добавлен REST API с помощью FastAPI, что позволяет легко интегрировать данные с другими приложениями или сервисами.

7. **Гибкость CLI**:
   - Используется `argparse` для настройки параметров через командную строку (`--max`, `--output`).
   - Проверяется условие 0 < N ≤ 100 для параметра `--max`.

8. **Сохранение данных**:
   - Данные сохраняются в двух форматах: SQLite для долгосрочного хранения и CSV для удобного анализа в других инструментах.
   - SQLite база данных создаётся автоматически при первом запуске.

## Пример выходных данных

### CSV (`tenders.csv`)

```csv
number,link,customer,goods,end_date
123456,https://rostender.info/tender/123456,N/A,Поставка оборудования,2025-08-15
789012,https://rostender.info/tender/789012,N/A,Услуги по ремонту,2025-08-20
...
```

### SQLite (`tenders.db`)

Таблица `tenders` содержит столбцы:
- `id` (автоинкрементный первичный ключ)
- `number` (номер тендера)
- `link` (ссылка на тендер)
- `customer` (заказчик, пока фиксированное значение "N/A")
- `goods` (наименование товаров/услуг)
- `end_date` (дата окончания)

### JSON (через API)

```json
[
  {
    "id": 1,
    "number": "123456",
    "link": "https://rostender.info/tender/123456",
    "customer": "N/A",
    "goods": "Поставка оборудования",
    "end_date": "2025-08-15"
  },
  ...
]
```

## Ограничения

- Поле `customer` в текущей версии фиксировано как "N/A", так как сайт не предоставляет эту информацию в открытом виде.
- Программа ограничена 5 страницами пагинации для предотвращения чрезмерной нагрузки на сайт.
- Зависимость от Chrome и ChromeDriver требует их наличия на системе.
- API работает только после запуска сервера (порт 8000).

## Возможные улучшения

- Добавить парсинг поля `customer` с детальной страницы тендера.
- Реализовать асинхронный парсинг для ускорения работы.
- Добавить обработку капчи или блокировок, если сайт их использует.
- Внедрить валидацию данных перед сохранением.
- Добавить поддержку других форматов вывода (например, JSON).

## Лицензия

MIT License